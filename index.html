<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="AsciiDoc 8.6.10">
<title>djmail documentation</title>
<link rel="stylesheet" href="static/niwi.css" type="text/css">
<link rel="stylesheet" href="static/pygments.css" type="text/css">


<script type="text/javascript" src="static/asciidoc.js"></script>
<script type="text/javascript" src="static/niwi.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:800px">
<div id="header">
<h1>djmail documentation</h1>
<span id="author">David Barragan,</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:bameda@dbarragan.com">bameda@dbarragan.com</a>&gt;</span><br>
<span id="revnumber">version 1.1.0,</span>
<span id="revdate">2018-06-06</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>djmail</em> is a <a href="#license">BSD Licensed</a>, simple and nonobstructive django email middleware.
<em>djmail</em> was created by Andrey Antukh &lt;<a href="mailto:niwi@niwi.nz">niwi@niwi.nz</a>&gt; and is maintened by David Barrag√°n &lt;<a href="mailto:bameda@dbarragan.com">bameda@dbarragan.com</a>&gt;</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_why_use_djmail">2. Why use djmail?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Because it:</p></div>
<div class="ulist"><ul>
<li>
<p>
Sends emails asynchronously without additional libraries.
</p>
</li>
<li>
<p>
Sends emails using celery tasks.
</p>
</li>
<li>
<p>
Can retry sending failed messages (with cron task or celery periodic task).
</p>
</li>
<li>
<p>
Can assign delivery priority.
</p>
</li>
<li>
<p>
Has a powerfull class to build emails from templates.
</p>
</li>
<li>
<p>
Works transparently (works as middleware for native django email backends)
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_how_to_install">2.1. How to install?</h3>
<div class="paragraph"><p>The simplest way to get djmail for your project, is installing it using <strong>pip</strong>:</p></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide">3. User guide</h2>
<div class="sectionbody">
<div class="paragraph"><p>As I have mentioned previously, <em>djmail</em> works as a middleware.</p></div>
<div class="ulist"><ul>
<li>
<p>
It saves emails using django orm and track its status. If an exception is raised during sending,
  it marks the email as <strong>failed</strong> and stores the exception traceback for posterior analysis.
</p>
</li>
<li>
<p>
Exposes usefull commands and methods for retring to send failed messages.
</p>
</li>
<li>
<p>
Handles priority, with ability to delay sending of messages with lowest priorty
  to periodic task (with cron or celery).
</p>
</li>
</ul></div>
<div class="paragraph"><p>To get djmail working on your project, you should configure it. An example setup:</p></div>
<div class="listingblock">
<div class="title">Add it to the <span class="monospaced">INSTALLED_APPS</span> your Django settings:</div>
<div class="content"></div></div>
<div class="listingblock">
<div class="title">Set the email backends in the settings.</div>
<div class="content"></div></div>
<div class="paragraph"><p>This specifies: emails are managed by djmail default backend and actually sent using
console based django builtin backend.</p></div>
<div class="sect2">
<h3 id="_how_to_use">3.1. How to use?</h3>
<div class="paragraph"><p>djmail works as a middleware, and the simplest way to use it, is to not think, just send
emails the way you did before.</p></div>
</div>
<div class="sect2">
<h3 id="_backends">3.2. Backends</h3>
<div class="paragraph"><p><em>djmail</em> comes with three backends:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>djmail.backends.default.EmailBackend</strong><br>
  send emails synchronously using real backend.
</p>
</li>
<li>
<p>
<strong>djmail.backends.async.EmailBackend</strong><br>
  send emails asynchronously using <span class="monospaced">concurrent.futures</span>.
</p>
</li>
<li>
<p>
<strong>djmail.backends.celery.EmailBackend</strong><br>
  send emails asynchronously using celery tasks.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_management_commands">3.3. Management Commands</h3>
<div class="paragraph"><p><em>djmail</em> has two built-in management commands:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>djmail_retry_send_messages</strong><br>
  Sends all mail in the queue, also retrying previously failed email messages. After the global retry limit is reached, an email is marked as discarded.
</p>
</li>
<li>
<p>
<strong>djmail_delete_old_messages --days=183</strong><br>
  <em>djmail</em> stores all messages in the database, which could eventually take up a lot of database space for data which is not important to keep. This command deletes all succesfully sent messages older than the provided age (when the <span class="monospaced">--days</span> parameter is ommited, the default value is 6 months).
</p>
</li>
</ul></div>
<div class="paragraph"><p>An example setup using cronjobs (<span class="monospaced">sudo crontab -e</span>) would be</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>@hourly python manage.py djmail_retry_send_messages
@weekly python manage.py djmail_delete_old_messages --days=31</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_template_emails">4. Template Emails</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>djmail</em> comes with two util classes for easily building emails from templates:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>djmail.template_mail.TemplateMail</strong>: low level interface.
</p>
</li>
<li>
<p>
<strong>djmail.template_mail.MagicMailBuilder</strong>: high level interface with some magic.
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_templatemail">4.1. TemplateMail</h3>
<div class="paragraph"><p>This is a low level interface for buiding emails using templates. It allows to statically define email classes for posterior
usage:</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Also you can obtain a native django email instance from TemplateMail instance:</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p><span class="monospaced">TemplateMail</span> default implementation searches these templates:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">emails/some_email-body-html.html</span>
</p>
</li>
<li>
<p>
<span class="monospaced">emails/some_email-body-text.html</span>
</p>
</li>
<li>
<p>
<span class="monospaced">emails/some_email-subject.html</span>
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Text version of email is ommited if template does not exists.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_magicmailbuilder">4.2. MagicMailBuilder</h3>
<div class="paragraph"><p>This is a more powerful way for building email messages from templates. Behind the scenes, it uses
<span class="monospaced">TemplateMail</span> implementation but exposes a dynamic api that allows building of subclasses on demand.</p></div>
<div class="listingblock">
<div class="title">Example that represents the same behavior as previous example using dynamic api of <span class="monospaced">MagicMailBuilder</span></div>
<div class="content"></div></div>
<div class="paragraph"><p>Additionally, instead of receiver email address you can pass a django model
instance that represents a user (it should have "email" field for work):</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Magic builder is really magic, and if your user class has lang field, magic builder uses it to setup a correct user language
for rendering email in user locale.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Also, you can specify a custom "lang" on context for same purpose.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_settings">5. Settings</h2>
<div class="sectionbody">
<div class="paragraph"><p>djmail exposes some additional settings for costumizing a great part of default behavior.</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>DJMAIL_REAL_BACKEND</strong><br>
  Indicates to djmail which django email backend to use for delivering email messages.<br>
  Default: <span class="monospaced">django.core.mail.backends.console.EmailBackend</span>
</p>
</li>
<li>
<p>
<strong>DJMAIL_MAX_RETRY_NUMBER</strong><br>
  Set a default maximum retry number for delivering failed messages.<br>
  Default: 3
</p>
</li>
<li>
<p>
<strong>DJMAIL_BODY_TEMPLATE_PROTOTYPE</strong><br>
  Prototype for making body template path.<br>
  Default: <span class="monospaced">emails/{name}-body-{type}.{ext}</span>
</p>
</li>
<li>
<p>
<strong>DJMAIL_SUBJECT_TEMPLATE_PROTOTYPE</strong><br>
  Prototype for make subject template path.<br>
  Default: <span class="monospaced">emails/{name}-subject.{ext}</span>
</p>
</li>
<li>
<p>
<strong>DJMAIL_TEMPLATE_EXTENSION</strong><br>
  Extension used for build a final path of email templates.<br>
  Default: <span class="monospaced">html</span>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="license">6. License</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content"></div></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 1.1.0<br>
Last updated
 2018-06-06 13:00:51 CEST
</div>
</div>
</body>
</html>
